<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>EZBIT Frontend - Code Flow Report</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/cytoscape/3.28.1/cytoscape.min.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        :root {
            --bg-primary: #ffffff;
            --bg-secondary: #f8fafc;
            --bg-tertiary: #f1f5f9;
            --glass-bg: rgba(0, 0, 0, 0.02);
            --glass-bg-hover: rgba(0, 0, 0, 0.04);
            --glass-bg-active: rgba(0, 0, 0, 0.06);
            --glass-border: rgba(0, 0, 0, 0.08);
            --glass-border-hover: rgba(0, 0, 0, 0.15);
            --text-primary: #1e293b;
            --text-secondary: #64748b;
            --accent-blue: #3b82f6;
            --accent-green: #22c55e;
            --accent-purple: #8b5cf6;
            --accent-orange: #f97316;
            --accent-red: #1e293b;
            --accent-yellow: #eab308;
            --accent-black: #ef4444;
            --border-color: rgba(0, 0, 0, 0.1);
            --blur-amount: 12px;
            --shadow-color: rgba(0, 0, 0, 0.1);
        }

        body {
            font-family: 'Pretendard', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: linear-gradient(135deg, #ffffff 0%, #f8fafc 25%, #f1f5f9 50%, #f8fafc 75%, #ffffff 100%);
            background-attachment: fixed;
            color: var(--text-primary);
            min-height: 100vh;
            display: flex;
            position: relative;
        }

        /* Animated gradient orbs for depth */
        body::before {
            content: '';
            position: fixed;
            top: -50%;
            left: -50%;
            width: 200%;
            height: 200%;
            background:
                radial-gradient(circle at 20% 80%, rgba(139, 92, 246, 0.06) 0%, transparent 50%),
                radial-gradient(circle at 80% 20%, rgba(59, 130, 246, 0.05) 0%, transparent 50%),
                radial-gradient(circle at 40% 40%, rgba(236, 72, 153, 0.03) 0%, transparent 40%);
            animation: float 20s ease-in-out infinite;
            pointer-events: none;
            z-index: -1;
        }

        @keyframes float {
            0%, 100% { transform: translate(0, 0) rotate(0deg); }
            33% { transform: translate(2%, 2%) rotate(1deg); }
            66% { transform: translate(-1%, 1%) rotate(-1deg); }
        }

        /* Custom scrollbar */
        ::-webkit-scrollbar {
            width: 6px;
            height: 6px;
        }

        ::-webkit-scrollbar-track {
            background: rgba(0, 0, 0, 0.02);
        }

        ::-webkit-scrollbar-thumb {
            background: rgba(0, 0, 0, 0.15);
            border-radius: 3px;
        }

        ::-webkit-scrollbar-thumb:hover {
            background: rgba(0, 0, 0, 0.25);
        }

        /* Sidebar */
        .sidebar {
            width: 320px;
            background: var(--glass-bg);
            backdrop-filter: blur(var(--blur-amount));
            -webkit-backdrop-filter: blur(var(--blur-amount));
            border-right: 1px solid var(--glass-border);
            display: flex;
            flex-direction: column;
            overflow: hidden;
        }

        .sidebar-header {
            padding: 24px 20px;
            background: linear-gradient(135deg, rgba(139, 92, 246, 0.08), rgba(59, 130, 246, 0.05));
            border-bottom: 1px solid var(--glass-border);
            position: relative;
            overflow: hidden;
        }

        .sidebar-header::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 1px;
            background: linear-gradient(90deg, transparent, rgba(0, 0, 0, 0.08), transparent);
        }

        .sidebar-header h1 {
            font-size: 1.5rem;
            margin-bottom: 5px;
            background: linear-gradient(135deg, #7c3aed, #3b82f6, #10b981);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .sidebar-header p {
            font-size: 0.85rem;
            color: var(--text-secondary);
        }

        .nav-section {
            padding: 15px 20px;
            border-bottom: 1px solid var(--glass-border);
        }

        .nav-section h3 {
            font-size: 0.7rem;
            text-transform: uppercase;
            letter-spacing: 1.5px;
            color: var(--text-secondary);
            margin-bottom: 12px;
            font-weight: 500;
        }

        .nav-btn {
            display: block;
            width: 100%;
            padding: 11px 15px;
            margin-bottom: 6px;
            background: transparent;
            border: 1px solid transparent;
            border-radius: 10px;
            color: var(--text-primary);
            font-size: 0.9rem;
            text-align: left;
            cursor: pointer;
            transition: all 0.25s ease;
        }

        .nav-btn:hover {
            background: var(--glass-bg-hover);
            border-color: var(--glass-border);
            transform: translateX(4px);
        }

        .nav-btn.active {
            background: linear-gradient(135deg, rgba(139, 92, 246, 0.12), rgba(59, 130, 246, 0.08));
            border-color: rgba(139, 92, 246, 0.3);
            color: #7c3aed;
            box-shadow: 0 0 20px rgba(139, 92, 246, 0.08);
        }

        .search-box {
            padding: 15px 20px;
            border-bottom: 1px solid var(--glass-border);
        }

        .search-box input {
            width: 100%;
            padding: 12px 16px;
            background: #ffffff;
            border: 1px solid var(--glass-border);
            border-radius: 10px;
            color: var(--text-primary);
            font-size: 0.9rem;
            transition: all 0.25s ease;
        }

        .search-box input::placeholder {
            color: var(--text-secondary);
        }

        .search-box input:focus {
            outline: none;
            border-color: rgba(139, 92, 246, 0.4);
            background: #ffffff;
            box-shadow: 0 0 20px rgba(139, 92, 246, 0.08);
        }

        .node-list {
            flex: 1;
            overflow-y: auto;
            padding: 15px;
        }

        .node-item {
            padding: 14px 16px;
            margin-bottom: 10px;
            background: var(--glass-bg);
            border: 1px solid var(--glass-border);
            border-radius: 12px;
            cursor: pointer;
            transition: all 0.25s ease;
            backdrop-filter: blur(8px);
            -webkit-backdrop-filter: blur(8px);
        }

        .node-item:hover {
            background: var(--glass-bg-hover);
            border-color: var(--glass-border-hover);
            transform: translateX(6px);
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.2);
        }

        .node-item .node-type {
            font-size: 0.65rem;
            text-transform: uppercase;
            letter-spacing: 1px;
            padding: 3px 10px;
            border-radius: 6px;
            display: inline-block;
            margin-bottom: 6px;
            font-weight: 600;
        }

        .node-item .node-label {
            font-weight: 600;
            font-size: 0.9rem;
        }

        .node-item .node-path {
            font-size: 0.75rem;
            color: var(--text-secondary);
            margin-top: 4px;
            opacity: 0.8;
        }

        /* Node type colors - with glassmorphism style */
        .type-page {
            background: linear-gradient(135deg, rgba(96, 165, 250, 0.9), rgba(59, 130, 246, 0.9));
            color: #0f172a;
            box-shadow: 0 2px 10px rgba(96, 165, 250, 0.3);
        }
        .type-api-route {
            background: linear-gradient(135deg, rgba(74, 222, 128, 0.9), rgba(34, 197, 94, 0.9));
            color: #0f172a;
            box-shadow: 0 2px 10px rgba(74, 222, 128, 0.3);
        }
        .type-server-action {
            background: linear-gradient(135deg, rgba(192, 132, 252, 0.9), rgba(139, 92, 246, 0.9));
            color: #0f172a;
            box-shadow: 0 2px 10px rgba(192, 132, 252, 0.3);
        }
        .type-provider {
            background: linear-gradient(135deg, rgba(251, 146, 60, 0.9), rgba(234, 88, 12, 0.9));
            color: #0f172a;
            box-shadow: 0 2px 10px rgba(251, 146, 60, 0.3);
        }
        .type-hook {
            background: linear-gradient(135deg, rgba(239, 68, 68, 0.9), rgba(220, 38, 38, 0.9));
            color: #ffffff;
            box-shadow: 0 2px 10px rgba(239, 68, 68, 0.3);
        }
        .type-component {
            background: linear-gradient(135deg, rgba(253, 224, 71, 0.9), rgba(234, 179, 8, 0.9));
            color: #0f172a;
            box-shadow: 0 2px 10px rgba(253, 224, 71, 0.3);
        }
        .type-database {
            background: linear-gradient(135deg, rgba(30, 41, 59, 0.9), rgba(15, 23, 42, 0.9));
            color: white;
            box-shadow: 0 2px 10px rgba(30, 41, 59, 0.3);
        }
        .type-external-api {
            background: linear-gradient(135deg, rgba(148, 163, 184, 0.9), rgba(100, 116, 139, 0.9));
            color: white;
            box-shadow: 0 2px 10px rgba(148, 163, 184, 0.2);
        }

        /* Main content */
        .main-content {
            flex: 1;
            display: flex;
            flex-direction: column;
            overflow: hidden;
        }

        .toolbar {
            padding: 16px 24px;
            background: var(--glass-bg);
            backdrop-filter: blur(var(--blur-amount));
            -webkit-backdrop-filter: blur(var(--blur-amount));
            border-bottom: 1px solid var(--glass-border);
            display: flex;
            align-items: center;
            gap: 16px;
        }

        .toolbar-btn {
            padding: 10px 18px;
            background: var(--glass-bg);
            border: 1px solid var(--glass-border);
            border-radius: 10px;
            color: var(--text-primary);
            font-size: 0.85rem;
            cursor: pointer;
            transition: all 0.25s ease;
            backdrop-filter: blur(8px);
            -webkit-backdrop-filter: blur(8px);
        }

        .toolbar-btn:hover {
            background: var(--glass-bg-hover);
            border-color: rgba(139, 92, 246, 0.3);
            color: #7c3aed;
            box-shadow: 0 0 20px rgba(139, 92, 246, 0.08);
            transform: translateY(-1px);
        }

        .view-toggle {
            display: flex;
            background: rgba(0, 0, 0, 0.04);
            border-radius: 12px;
            padding: 4px;
            border: 1px solid var(--glass-border);
        }

        .view-toggle button {
            padding: 8px 14px;
            background: transparent;
            border: none;
            border-radius: 8px;
            color: var(--text-secondary);
            cursor: pointer;
            transition: all 0.25s ease;
            font-size: 0.85rem;
        }

        .view-toggle button:hover {
            color: var(--text-primary);
        }

        .view-toggle button.active {
            background: linear-gradient(135deg, #8b5cf6, #3b82f6);
            color: white;
            box-shadow: 0 2px 15px rgba(139, 92, 246, 0.2);
        }

        /* Graph container */
        #cy {
            flex: 1;
            background: transparent;
        }

        /* Detail panel */
        .detail-panel {
            position: fixed;
            right: 0;
            top: 0;
            width: 450px;
            height: 100vh;
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(20px);
            -webkit-backdrop-filter: blur(20px);
            border-left: 1px solid var(--glass-border);
            transform: translateX(100%);
            transition: transform 0.35s cubic-bezier(0.4, 0, 0.2, 1);
            z-index: 1000;
            display: flex;
            flex-direction: column;
            overflow: hidden;
            box-shadow: -10px 0 40px rgba(0, 0, 0, 0.1);
        }

        .detail-panel.open {
            transform: translateX(0);
        }

        .detail-header {
            padding: 24px;
            background: linear-gradient(135deg, rgba(139, 92, 246, 0.08), rgba(59, 130, 246, 0.05));
            border-bottom: 1px solid var(--glass-border);
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            position: relative;
        }

        .detail-header::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 1px;
            background: linear-gradient(90deg, transparent, rgba(0, 0, 0, 0.05), transparent);
        }

        .detail-header .node-type {
            font-size: 0.65rem;
            text-transform: uppercase;
            letter-spacing: 1px;
            padding: 3px 10px;
            border-radius: 6px;
            display: inline-block;
            margin-bottom: 6px;
            font-weight: 600;
        }

        .detail-header h2 {
            font-size: 1.2rem;
            margin-bottom: 5px;
            color: var(--text-primary);
        }

        .detail-header .close-btn {
            width: 32px;
            height: 32px;
            background: var(--glass-bg);
            border: 1px solid var(--glass-border);
            border-radius: 8px;
            color: var(--text-primary);
            cursor: pointer;
            font-size: 1.2rem;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.25s ease;
        }

        .detail-header .close-btn:hover {
            background: rgba(248, 113, 113, 0.2);
            border-color: rgba(248, 113, 113, 0.4);
            color: #f87171;
        }

        .detail-content {
            flex: 1;
            overflow-y: auto;
            padding: 24px;
        }

        .detail-section {
            margin-bottom: 28px;
        }

        .detail-section h4 {
            font-size: 0.7rem;
            text-transform: uppercase;
            letter-spacing: 1.5px;
            color: var(--text-secondary);
            margin-bottom: 12px;
            padding-bottom: 8px;
            border-bottom: 1px solid var(--glass-border);
            font-weight: 500;
        }

        .detail-section p {
            font-size: 0.9rem;
            line-height: 1.7;
            color: var(--text-secondary);
        }

        .code-block {
            background: #f1f5f9;
            border: 1px solid var(--glass-border);
            border-radius: 10px;
            padding: 16px;
            font-family: 'Fira Code', 'Consolas', monospace;
            font-size: 0.8rem;
            overflow-x: auto;
            white-space: pre-wrap;
            line-height: 1.6;
            color: #6366f1;
        }

        .tag-list {
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
        }

        .tag {
            padding: 6px 12px;
            background: var(--glass-bg);
            border: 1px solid var(--glass-border);
            border-radius: 8px;
            font-size: 0.8rem;
            transition: all 0.2s ease;
        }

        .tag:hover {
            background: var(--glass-bg-hover);
        }

        .tag.highlight {
            background: linear-gradient(135deg, rgba(139, 92, 246, 0.12), rgba(59, 130, 246, 0.08));
            border-color: rgba(139, 92, 246, 0.3);
            color: #7c3aed;
        }

        /* Summary view */
        .summary-view {
            display: none;
            padding: 40px;
            overflow-y: auto;
            height: 100%;
        }

        .summary-view.active {
            display: block;
        }

        .summary-card {
            background: var(--glass-bg);
            backdrop-filter: blur(var(--blur-amount));
            -webkit-backdrop-filter: blur(var(--blur-amount));
            border: 1px solid var(--glass-border);
            border-radius: 16px;
            padding: 28px;
            margin-bottom: 28px;
            position: relative;
            overflow: hidden;
        }

        .summary-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 1px;
            background: linear-gradient(90deg, transparent, rgba(0, 0, 0, 0.05), transparent);
        }

        .summary-card h2 {
            font-size: 1.4rem;
            margin-bottom: 18px;
            background: linear-gradient(135deg, #7c3aed, #3b82f6);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .summary-card h3 {
            font-size: 1.1rem;
            margin: 24px 0 12px;
            color: #7c3aed;
        }

        .summary-card p, .summary-card li {
            font-size: 0.95rem;
            line-height: 1.8;
            color: var(--text-secondary);
        }

        .summary-card ul {
            padding-left: 20px;
            margin-top: 12px;
        }

        .summary-card li {
            margin-bottom: 10px;
        }

        .summary-card li strong {
            color: #0891b2;
        }

        .flow-step {
            display: flex;
            align-items: flex-start;
            padding: 18px;
            background: var(--glass-bg);
            border: 1px solid var(--glass-border);
            border-radius: 12px;
            margin-bottom: 12px;
            transition: all 0.25s ease;
        }

        .flow-step:hover {
            background: var(--glass-bg-hover);
            transform: translateX(4px);
        }

        .flow-step-num {
            width: 32px;
            height: 32px;
            background: linear-gradient(135deg, #8b5cf6, #3b82f6);
            color: white;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            font-size: 0.85rem;
            margin-right: 16px;
            flex-shrink: 0;
            box-shadow: 0 2px 15px rgba(139, 92, 246, 0.15);
        }

        .flow-step-content strong {
            color: #0891b2;
        }

        .flow-step-content small {
            color: var(--text-secondary);
            opacity: 0.8;
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(140px, 1fr));
            gap: 16px;
            margin-top: 20px;
        }

        .stat-item {
            background: var(--glass-bg);
            border: 1px solid var(--glass-border);
            padding: 20px 16px;
            border-radius: 14px;
            text-align: center;
            transition: all 0.25s ease;
        }

        .stat-item:hover {
            background: var(--glass-bg-hover);
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.2);
        }

        .stat-item .value {
            font-size: 2.2rem;
            font-weight: bold;
            background: linear-gradient(135deg, #7c3aed, #3b82f6);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .stat-item .label {
            font-size: 0.8rem;
            color: var(--text-secondary);
            margin-top: 6px;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        /* Glossary */
        .glossary-term {
            padding: 18px;
            background: var(--glass-bg);
            border: 1px solid var(--glass-border);
            border-radius: 12px;
            margin-bottom: 12px;
            transition: all 0.25s ease;
        }

        .glossary-term:hover {
            background: var(--glass-bg-hover);
        }

        .glossary-term dt {
            font-weight: 600;
            color: #ea580c;
            margin-bottom: 8px;
            font-size: 1rem;
        }

        .glossary-term dd {
            font-size: 0.9rem;
            color: var(--text-secondary);
            line-height: 1.7;
        }

        /* Responsive */
        @media (max-width: 1200px) {
            .sidebar {
                width: 280px;
            }
            .detail-panel {
                width: 400px;
            }
        }

        @media (max-width: 768px) {
            .sidebar {
                display: none;
            }
            .detail-panel {
                width: 100%;
            }
        }

        /* Legend */
        .legend {
            padding: 16px 20px;
            background: linear-gradient(135deg, rgba(139, 92, 246, 0.05), rgba(59, 130, 246, 0.03));
            border-top: 1px solid var(--glass-border);
        }

        .legend h4 {
            font-size: 0.7rem;
            text-transform: uppercase;
            letter-spacing: 1.5px;
            color: var(--text-secondary);
            margin-bottom: 12px;
            font-weight: 500;
        }

        .legend-items {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
        }

        .legend-item {
            display: flex;
            align-items: center;
            gap: 6px;
            font-size: 0.75rem;
            padding: 4px 10px;
            background: var(--glass-bg);
            border-radius: 6px;
            border: 1px solid var(--glass-border);
        }

        .legend-color {
            width: 10px;
            height: 10px;
            border-radius: 3px;
            box-shadow: 0 0 8px currentColor;
        }

        /* Selection highlight for graph */
        #cy .node-selected {
            border-width: 3px;
            border-color: white;
        }
    </style>
</head>
<body>
    <!-- Sidebar -->
    <aside class="sidebar">
        <div class="sidebar-header">
            <h1>CODE FLOW: EZBIT</h1>
            <p>Next.js 15 + Supabase + Socket.io</p>
        </div>

        <nav class="nav-section">
            <h3>Views</h3>
            <button class="nav-btn active" data-view="summary" onclick="showView('summary')">Overview Summary</button>
            <button class="nav-btn" data-view="graph" onclick="showView('graph')">Interactive Graph</button>
            <button class="nav-btn" data-view="flows" onclick="showView('flows')">Data Flows</button>
            <button class="nav-btn" data-view="glossary" onclick="showView('glossary')">Glossary</button>
        </nav>

        <div class="search-box">
            <input type="text" id="searchInput" placeholder="Search nodes..." oninput="filterNodes(this.value)">
        </div>

        <div class="node-list" id="nodeList">
            <!-- Dynamically populated -->
        </div>

        <div class="legend">
            <h4>Node Types</h4>
            <div class="legend-items">
                <div class="legend-item"><div class="legend-color" style="background: var(--accent-blue)"></div>Page</div>
                <div class="legend-item"><div class="legend-color" style="background: var(--accent-green)"></div>API Route</div>
                <div class="legend-item"><div class="legend-color" style="background: var(--accent-purple)"></div>Server Action</div>
                <div class="legend-item"><div class="legend-color" style="background: var(--accent-orange)"></div>Provider</div>
                <div class="legend-item"><div class="legend-color" style="background: var(--accent-black)"></div>Hook</div>
                <div class="legend-item"><div class="legend-color" style="background: var(--accent-yellow)"></div>Component</div>
                <div class="legend-item"><div class="legend-color" style="background: var(--accent-red)"></div>Database</div>
            </div>
        </div>
    </aside>

    <!-- Main Content -->
    <main class="main-content">
        <div class="toolbar">
            <div class="view-toggle">
                <button class="active" onclick="setGraphLayout('dagre')">Hierarchical</button>
                <button onclick="setGraphLayout('circle')">Circle</button>
                <button onclick="setGraphLayout('grid')">Grid</button>
            </div>
            <button class="toolbar-btn" onclick="cy.fit()">Fit to View</button>
            <button class="toolbar-btn" onclick="cy.reset()">Reset Zoom</button>
            <button class="toolbar-btn" onclick="downloadJSON()">Export JSON</button>
        </div>

        <!-- Graph View -->
        <div id="cy"></div>

        <!-- Summary View -->
        <div class="summary-view active" id="summaryView">
            <div class="summary-card">
                <h2>EZBIT Frontend Architecture Overview</h2>
                <p>EZBIT은 암호화폐 모의 거래 플랫폼으로, 실시간 시세 데이터와 모의 주문 기능을 제공합니다. Next.js 15 App Router를 기반으로 서버 컴포넌트, 서버 액션, 실시간 WebSocket을 활용한 현대적인 풀스택 아키텍처를 구현했습니다.</p>

                <div class="stats-grid">
                    <div class="stat-item">
                        <div class="value">9</div>
                        <div class="label">Pages</div>
                    </div>
                    <div class="stat-item">
                        <div class="value">7</div>
                        <div class="label">API Routes</div>
                    </div>
                    <div class="stat-item">
                        <div class="value">7</div>
                        <div class="label">Server Actions</div>
                    </div>
                    <div class="stat-item">
                        <div class="value">4</div>
                        <div class="label">Providers</div>
                    </div>
                    <div class="stat-item">
                        <div class="value">10</div>
                        <div class="label">Custom Hooks</div>
                    </div>
                    <div class="stat-item">
                        <div class="value">3</div>
                        <div class="label">DB Tables</div>
                    </div>
                </div>

                <h3>Key Architectural Patterns</h3>
                <ul>
                    <li><strong>실시간 데이터 + 낙관적 업데이트:</strong> WebSocket으로 현재가, 오더북, 체결내역을 실시간 수신하고, 주문 시 낙관적 업데이트로 즉각적인 UI 반응성을 제공합니다.</li>
                    <li><strong>선택적 Provider 패턴:</strong> TickerProvider, MarketListProvider는 실시간 데이터가 필요한 라우트(/exchange, /my-assets 등)에서만 활성화됩니다.</li>
                    <li><strong>Early Return + Throw 에러 패턴:</strong> 서버 액션에서 try-catch 없이 Early Return과 throw로 에러를 처리합니다.</li>
                    <li><strong>가상 스크롤 최적화:</strong> MarketList는 @tanstack/react-virtual로 수천 개 종목을 효율적으로 렌더링합니다.</li>
                </ul>
            </div>

            <div class="summary-card">
                <h2>Data Flow Architecture</h2>
                <p>애플리케이션의 데이터는 크게 세 가지 경로로 흐릅니다:</p>

                <h3>1. 실시간 시세 데이터 (Upbit API + WebSocket)</h3>
                <ul>
                    <li>앱 초기화 시 REST API로 전체 종목 현재가 데이터를 한 번에 가져옵니다.</li>
                    <li>이후 WebSocket Server가 Upbit WebSocket을 중계하여 실시간 업데이트를 전달합니다.</li>
                    <li>500ms 스로틀링으로 과도한 리렌더링을 방지합니다.</li>
                </ul>

                <h3>2. 사용자 데이터 (Supabase)</h3>
                <ul>
                    <li>TanStack Query로 캐싱하며, 30분 staleTime으로 불필요한 요청을 줄입니다.</li>
                    <li>주문 시 낙관적 업데이트로 UI를 즉시 반영하고, onSettled에서 서버 데이터로 동기화합니다.</li>
                </ul>

                <h3>3. 트렌드 데이터 (외부 API)</h3>
                <ul>
                    <li>/trends 페이지는 서버 컴포넌트에서 환율, 뉴스, 유튜브 데이터를 병렬로 페칭합니다.</li>
                    <li>Promise.all로 5개 데이터 소스를 동시에 요청하여 초기 로딩 시간을 최소화합니다.</li>
                </ul>
            </div>
        </div>

        <!-- Flows View -->
        <div class="summary-view" id="flowsView">
            <div class="summary-card">
                <h2>실시간 현재가 업데이트 플로우</h2>
                <p>WebSocket을 통해 실시간으로 모든 종목의 현재가를 업데이트합니다.</p>

                <div class="flow-step">
                    <div class="flow-step-num">1</div>
                    <div class="flow-step-content">
                        <strong>MarketList</strong> - 마운트 시 useInitialTickers로 초기 데이터 페칭
                    </div>
                </div>
                <div class="flow-step">
                    <div class="flow-step-num">2</div>
                    <div class="flow-step-content">
                        <strong>useInitialTickers</strong> - /api/tickers로 전체 종목 현재가 조회
                    </div>
                </div>
                <div class="flow-step">
                    <div class="flow-step-num">3</div>
                    <div class="flow-step-content">
                        <strong>POST /api/tickers</strong> - Upbit REST API 호출
                    </div>
                </div>
                <div class="flow-step">
                    <div class="flow-step-num">4</div>
                    <div class="flow-step-content">
                        <strong>useTickerSocket</strong> - WebSocket 연결 및 구독 시작
                    </div>
                </div>
                <div class="flow-step">
                    <div class="flow-step-num">5</div>
                    <div class="flow-step-content">
                        <strong>WebSocket Server</strong> - ticker-update 이벤트 발생
                    </div>
                </div>
                <div class="flow-step">
                    <div class="flow-step-num">6</div>
                    <div class="flow-step-content">
                        <strong>useTickerSocket</strong> - 500ms 스로틀링 후 상태 업데이트
                    </div>
                </div>
                <div class="flow-step">
                    <div class="flow-step-num">7</div>
                    <div class="flow-step-content">
                        <strong>TickerProvider</strong> - TickerContext.tickers 업데이트
                    </div>
                </div>
                <div class="flow-step">
                    <div class="flow-step-num">8</div>
                    <div class="flow-step-content">
                        <strong>UI Components</strong> - 가격 변동 반영 리렌더링
                    </div>
                </div>
            </div>

            <div class="summary-card">
                <h2>매수 주문 플로우</h2>
                <p>사용자가 매수 주문을 실행하면 낙관적 업데이트로 즉시 UI에 반영되고, 서버에서 데이터베이스를 업데이트합니다.</p>

                <div class="flow-step">
                    <div class="flow-step-num">1</div>
                    <div class="flow-step-content">
                        <strong>OrderForm</strong> - 사용자가 매수 버튼 클릭
                    </div>
                </div>
                <div class="flow-step">
                    <div class="flow-step-num">2</div>
                    <div class="flow-step-content">
                        <strong>useCreateBid</strong> - onMutate: 낙관적 업데이트 실행<br>
                        <small style="color: var(--text-secondary);">userQuery.holding_krw 차감, holdingsQuery 업데이트</small>
                    </div>
                </div>
                <div class="flow-step">
                    <div class="flow-step-num">3</div>
                    <div class="flow-step-content">
                        <strong>createBid (Server Action)</strong> - 서버 액션 호출
                    </div>
                </div>
                <div class="flow-step">
                    <div class="flow-step-num">4</div>
                    <div class="flow-step-content">
                        <strong>Supabase</strong> - history 테이블에 거래 내역 INSERT
                    </div>
                </div>
                <div class="flow-step">
                    <div class="flow-step-num">5</div>
                    <div class="flow-step-content">
                        <strong>Supabase</strong> - holdings 테이블 UPDATE/INSERT
                    </div>
                </div>
                <div class="flow-step">
                    <div class="flow-step-num">6</div>
                    <div class="flow-step-content">
                        <strong>Supabase</strong> - users 테이블 UPDATE (holding_krw 차감)
                    </div>
                </div>
                <div class="flow-step">
                    <div class="flow-step-num">7</div>
                    <div class="flow-step-content">
                        <strong>useCreateBid</strong> - onSettled: 쿼리 무효화로 서버 데이터 동기화
                    </div>
                </div>
            </div>

            <div class="summary-card">
                <h2>마켓 변경 플로우</h2>
                <p>사용자가 다른 종목을 선택하면 해당 종목의 오더북과 체결내역을 새로 로드합니다.</p>

                <div class="flow-step">
                    <div class="flow-step-num">1</div>
                    <div class="flow-step-content">
                        <strong>MarketList</strong> - 사용자가 종목 클릭
                    </div>
                </div>
                <div class="flow-step">
                    <div class="flow-step-num">2</div>
                    <div class="flow-step-content">
                        <strong>TickerProvider</strong> - setSelectedMarket(market) 호출
                    </div>
                </div>
                <div class="flow-step">
                    <div class="flow-step-num">3</div>
                    <div class="flow-step-content">
                        <strong>TickerProvider</strong> - fetchMarketData() 병렬 페칭<br>
                        <small style="color: var(--text-secondary);">오더북 + 체결내역 동시 요청</small>
                    </div>
                </div>
                <div class="flow-step">
                    <div class="flow-step-num">4</div>
                    <div class="flow-step-content">
                        <strong>GET /api/orderbook</strong> - Upbit orderbook API 호출
                    </div>
                </div>
                <div class="flow-step">
                    <div class="flow-step-num">5</div>
                    <div class="flow-step-content">
                        <strong>GET /api/trade-history</strong> - Upbit trades API 호출
                    </div>
                </div>
                <div class="flow-step">
                    <div class="flow-step-num">6</div>
                    <div class="flow-step-content">
                        <strong>TickerProvider</strong> - initialOrderbook, initialTradeHistory 상태 업데이트
                    </div>
                </div>
                <div class="flow-step">
                    <div class="flow-step-num">7</div>
                    <div class="flow-step-content">
                        <strong>useOrderbookSocket / useTradeSocket</strong> - 새 마켓으로 WebSocket 재구독
                    </div>
                </div>
            </div>

            <div class="summary-card">
                <h2>인증 상태 변화 플로우</h2>
                <p>사용자 로그인/로그아웃 시 관련 쿼리를 자동으로 무효화하거나 초기화합니다.</p>

                <div class="flow-step">
                    <div class="flow-step-num">1</div>
                    <div class="flow-step-content">
                        <strong>SignInPage</strong> - 사용자 로그인 완료
                    </div>
                </div>
                <div class="flow-step">
                    <div class="flow-step-num">2</div>
                    <div class="flow-step-content">
                        <strong>AuthProvider</strong> - onAuthStateChange 이벤트 감지
                    </div>
                </div>
                <div class="flow-step">
                    <div class="flow-step-num">3</div>
                    <div class="flow-step-content">
                        <strong>AuthProvider</strong> - session 존재 시 userQuery.invalidateQueries()
                    </div>
                </div>
                <div class="flow-step">
                    <div class="flow-step-num">4</div>
                    <div class="flow-step-content">
                        <strong>useUserData</strong> - getUserData 서버 액션 자동 호출
                    </div>
                </div>
                <div class="flow-step">
                    <div class="flow-step-num">5</div>
                    <div class="flow-step-content">
                        <strong>getUserData (Server Action)</strong> - Supabase에서 유저 정보 조회
                    </div>
                </div>
            </div>
        </div>

        <!-- Glossary View -->
        <div class="summary-view" id="glossaryView">
            <div class="summary-card">
                <h2>Glossary - 용어 사전</h2>
                <p>이 프로젝트에서 사용되는 주요 개념과 기술 용어들을 설명합니다.</p>

                <dl style="margin-top: 20px;">
                    <div class="glossary-term">
                        <dt>Server Component (서버 컴포넌트)</dt>
                        <dd>서버에서만 렌더링되는 React 컴포넌트입니다. 데이터베이스 쿼리나 파일 시스템 접근이 가능하며, 클라이언트에 JavaScript를 전송하지 않아 번들 크기를 줄입니다.</dd>
                    </div>
                    <div class="glossary-term">
                        <dt>Server Action (서버 액션)</dt>
                        <dd>Next.js 14+에서 도입된 기능으로, 'use server' 지시어를 사용하여 클라이언트에서 직접 서버 함수를 호출할 수 있습니다. API 라우트 없이 데이터 변경(mutation)을 처리합니다.</dd>
                    </div>
                    <div class="glossary-term">
                        <dt>Optimistic Update (낙관적 업데이트)</dt>
                        <dd>서버 응답을 기다리지 않고 UI를 먼저 업데이트하는 패턴입니다. 사용자 경험을 크게 개선하며, 서버 요청이 실패하면 이전 상태로 롤백합니다.</dd>
                    </div>
                    <div class="glossary-term">
                        <dt>Context Provider (컨텍스트 프로바이더)</dt>
                        <dd>React의 상태 공유 메커니즘입니다. TickerProvider처럼 여러 컴포넌트에서 공유해야 하는 상태를 props drilling 없이 전달합니다.</dd>
                    </div>
                    <div class="glossary-term">
                        <dt>WebSocket</dt>
                        <dd>양방향 실시간 통신 프로토콜입니다. HTTP와 달리 한 번 연결하면 서버와 클라이언트가 자유롭게 메시지를 주고받을 수 있어 실시간 시세 업데이트에 적합합니다.</dd>
                    </div>
                    <div class="glossary-term">
                        <dt>Throttling (스로틀링)</dt>
                        <dd>일정 시간 간격으로만 함수를 실행하도록 제한하는 기법입니다. 이 프로젝트에서는 500ms 스로틀링으로 과도한 상태 업데이트를 방지합니다.</dd>
                    </div>
                    <div class="glossary-term">
                        <dt>Virtual Scroll (가상 스크롤)</dt>
                        <dd>화면에 보이는 항목만 실제로 렌더링하는 기법입니다. MarketList에서 수천 개 종목을 효율적으로 표시하는 데 사용됩니다.</dd>
                    </div>
                    <div class="glossary-term">
                        <dt>TanStack Query (React Query)</dt>
                        <dd>서버 상태 관리 라이브러리입니다. 데이터 캐싱, 자동 재요청, 백그라운드 업데이트 등을 제공하여 서버 데이터 관리를 단순화합니다.</dd>
                    </div>
                    <div class="glossary-term">
                        <dt>Route Handler (라우트 핸들러)</dt>
                        <dd>Next.js App Router의 API 엔드포인트입니다. app/api/* 디렉토리에 route.ts 파일을 생성하여 REST API를 구현합니다.</dd>
                    </div>
                    <div class="glossary-term">
                        <dt>Supabase</dt>
                        <dd>오픈소스 Firebase 대안으로, PostgreSQL 데이터베이스, 인증, 스토리지를 제공합니다. 이 프로젝트의 사용자 데이터와 거래 내역을 저장합니다.</dd>
                    </div>
                    <div class="glossary-term">
                        <dt>Orderbook (오더북)</dt>
                        <dd>매수/매도 주문 목록입니다. 각 가격대별 주문 수량을 보여주어 시장의 매수/매도 압력을 파악할 수 있습니다.</dd>
                    </div>
                    <div class="glossary-term">
                        <dt>Ticker (티커)</dt>
                        <dd>특정 종목의 실시간 시세 정보입니다. 현재가, 변동률, 거래량 등의 데이터를 포함합니다.</dd>
                    </div>
                    <div class="glossary-term">
                        <dt>Candle Chart (캔들 차트)</dt>
                        <dd>일정 기간의 시가, 고가, 저가, 종가를 시각화한 차트입니다. 가격 추세와 변동성을 파악하는 데 사용됩니다.</dd>
                    </div>
                </dl>
            </div>
        </div>
    </main>

    <!-- Detail Panel -->
    <aside class="detail-panel" id="detailPanel">
        <div class="detail-header">
            <div>
                <span class="node-type" id="detailType">Page</span>
                <h2 id="detailTitle">Node Title</h2>
            </div>
            <button class="close-btn" onclick="closeDetailPanel()">&times;</button>
        </div>
        <div class="detail-content">
            <div class="detail-section">
                <h4>File Path</h4>
                <p id="detailPath" class="code-block">path/to/file.ts</p>
            </div>
            <div class="detail-section">
                <h4>Description</h4>
                <p id="detailDescription">Description goes here...</p>
            </div>
            <div class="detail-section" id="exportsSection">
                <h4>Exports</h4>
                <div class="tag-list" id="detailExports"></div>
            </div>
            <div class="detail-section" id="dependenciesSection">
                <h4>Dependencies</h4>
                <div class="tag-list" id="detailDependencies"></div>
            </div>
            <div class="detail-section" id="tablesSection">
                <h4>Database Operations</h4>
                <div class="tag-list" id="detailTables"></div>
            </div>
        </div>
    </aside>

    <script>
        // Graph data will be loaded from JSON
        let graphData = null;
        let cy = null;

        // Color scheme for node types
        const nodeColors = {
            'page': '#3b82f6',
            'api-route': '#22c55e',
            'server-action': '#8b5cf6',
            'provider': '#f97316',
            'hook': '#ef4444',
            'component': '#eab308',
            'database': '#1e293b',
            'external-api': '#64748b'
        };

        // Load graph data
        async function loadGraphData() {
            try {
                const response = await fetch('./assets/graph.json');
                graphData = await response.json();
                initializeGraph();
                populateNodeList();
            } catch (error) {
                console.error('Failed to load graph data:', error);
            }
        }

        // Initialize Cytoscape graph
        function initializeGraph() {
            const elements = [];

            // Add nodes
            graphData.nodes.forEach(node => {
                elements.push({
                    data: {
                        id: node.id,
                        label: node.label,
                        type: node.type,
                        ...node
                    }
                });
            });

            // Add edges
            graphData.edges.forEach(edge => {
                elements.push({
                    data: {
                        id: `${edge.source}-${edge.target}`,
                        source: edge.source,
                        target: edge.target,
                        label: edge.label
                    }
                });
            });

            cy = cytoscape({
                container: document.getElementById('cy'),
                elements: elements,
                style: [
                    {
                        selector: 'node',
                        style: {
                            'label': 'data(label)',
                            'text-valign': 'bottom',
                            'text-margin-y': 8,
                            'background-color': function(ele) {
                                return nodeColors[ele.data('type')] || '#666';
                            },
                            'color': '#1e293b',
                            'font-size': '11px',
                            'text-wrap': 'wrap',
                            'text-max-width': '120px',
                            'width': 45,
                            'height': 45,
                            'border-width': 2,
                            'border-color': '#cbd5e1'
                        }
                    },
                    {
                        selector: 'node:selected',
                        style: {
                            'border-width': 3,
                            'border-color': '#ffffff'
                        }
                    },
                    {
                        selector: 'edge',
                        style: {
                            'width': 1.5,
                            'line-color': '#94a3b8',
                            'target-arrow-color': '#94a3b8',
                            'target-arrow-shape': 'triangle',
                            'curve-style': 'bezier',
                            'arrow-scale': 0.8
                        }
                    },
                    {
                        selector: 'edge:selected',
                        style: {
                            'line-color': '#3b82f6',
                            'target-arrow-color': '#3b82f6',
                            'width': 2
                        }
                    }
                ],
                layout: {
                    name: 'cose',
                    padding: 50,
                    nodeRepulsion: 8000,
                    idealEdgeLength: 100,
                    nodeOverlap: 20
                }
            });

            // Node click handler
            cy.on('tap', 'node', function(evt) {
                const node = evt.target;
                showNodeDetail(node.data());
            });
        }

        // Populate sidebar node list
        function populateNodeList() {
            const nodeList = document.getElementById('nodeList');
            nodeList.innerHTML = '';

            graphData.nodes.forEach(node => {
                const item = document.createElement('div');
                item.className = 'node-item';
                item.onclick = () => {
                    showNodeDetail(node);
                    // Highlight in graph
                    if (cy) {
                        cy.nodes().unselect();
                        cy.$id(node.id).select();
                        cy.center(cy.$id(node.id));
                    }
                };

                item.innerHTML = `
                    <span class="node-type type-${node.type}">${node.type.replace('-', ' ')}</span>
                    <div class="node-label">${node.label}</div>
                    ${node.path ? `<div class="node-path">${node.path}</div>` : ''}
                `;

                nodeList.appendChild(item);
            });
        }

        // Filter nodes
        function filterNodes(query) {
            const items = document.querySelectorAll('.node-item');
            const lowerQuery = query.toLowerCase();

            items.forEach(item => {
                const label = item.querySelector('.node-label').textContent.toLowerCase();
                const path = item.querySelector('.node-path')?.textContent.toLowerCase() || '';

                if (label.includes(lowerQuery) || path.includes(lowerQuery)) {
                    item.style.display = 'block';
                } else {
                    item.style.display = 'none';
                }
            });
        }

        // Show node detail panel
        function showNodeDetail(data) {
            const panel = document.getElementById('detailPanel');

            document.getElementById('detailType').textContent = data.type.replace('-', ' ');
            document.getElementById('detailType').className = `node-type type-${data.type}`;
            document.getElementById('detailTitle').textContent = data.label;
            document.getElementById('detailPath').textContent = data.path || 'N/A';
            document.getElementById('detailDescription').textContent = data.description || 'No description available.';

            // Exports
            const exportsSection = document.getElementById('exportsSection');
            const exportsDiv = document.getElementById('detailExports');
            if (data.exports && data.exports.length > 0) {
                exportsSection.style.display = 'block';
                exportsDiv.innerHTML = data.exports.map(e => `<span class="tag highlight">${e}</span>`).join('');
            } else {
                exportsSection.style.display = 'none';
            }

            // Dependencies
            const depsSection = document.getElementById('dependenciesSection');
            const depsDiv = document.getElementById('detailDependencies');
            if (data.dependencies && data.dependencies.length > 0) {
                depsSection.style.display = 'block';
                depsDiv.innerHTML = data.dependencies.map(d => `<span class="tag">${d}</span>`).join('');
            } else {
                depsSection.style.display = 'none';
            }

            // Tables
            const tablesSection = document.getElementById('tablesSection');
            const tablesDiv = document.getElementById('detailTables');
            if (data.tables && data.tables.length > 0) {
                tablesSection.style.display = 'block';
                tablesDiv.innerHTML = data.tables.map(t => `<span class="tag">${t}</span>`).join('');
            } else {
                tablesSection.style.display = 'none';
            }

            panel.classList.add('open');
        }

        // Close detail panel
        function closeDetailPanel() {
            document.getElementById('detailPanel').classList.remove('open');
        }

        // Show different views
        function showView(viewName) {
            // Update nav buttons
            document.querySelectorAll('.nav-btn').forEach(btn => {
                btn.classList.remove('active');
                if (btn.dataset.view === viewName) {
                    btn.classList.add('active');
                }
            });

            // Show/hide views
            document.getElementById('cy').style.display = viewName === 'graph' ? 'block' : 'none';
            document.getElementById('summaryView').classList.toggle('active', viewName === 'summary');
            document.getElementById('flowsView').classList.toggle('active', viewName === 'flows');
            document.getElementById('glossaryView').classList.toggle('active', viewName === 'glossary');

            // Resize graph if shown
            if (viewName === 'graph' && cy) {
                cy.resize();
                cy.fit();
            }
        }

        // Set graph layout
        function setGraphLayout(layoutName) {
            if (!cy) return;

            document.querySelectorAll('.view-toggle button').forEach(btn => {
                btn.classList.remove('active');
            });
            event.target.classList.add('active');

            let layout;
            switch (layoutName) {
                case 'dagre':
                    layout = {
                        name: 'cose',
                        padding: 50,
                        nodeRepulsion: 8000,
                        idealEdgeLength: 100
                    };
                    break;
                case 'circle':
                    layout = {
                        name: 'circle',
                        padding: 50
                    };
                    break;
                case 'grid':
                    layout = {
                        name: 'grid',
                        padding: 50,
                        rows: 6
                    };
                    break;
            }

            cy.layout(layout).run();
        }

        // Download JSON
        function downloadJSON() {
            const dataStr = JSON.stringify(graphData, null, 2);
            const dataUri = 'data:application/json;charset=utf-8,' + encodeURIComponent(dataStr);

            const link = document.createElement('a');
            link.setAttribute('href', dataUri);
            link.setAttribute('download', 'ezbit-code-flow.json');
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
        }

        // Initialize on load
        document.addEventListener('DOMContentLoaded', loadGraphData);
    </script>
</body>
</html>
